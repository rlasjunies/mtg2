{"version":3,"sources":["pictures/picturesRoutes.ts"],"names":["uploadPicture","getAllPictures","deletePicture"],"mappings":"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","file":"pictures/picturesRoutes.js","sourcesContent":["import * as e from \"express\";\r\nimport * as formidable from \"formidable\";\r\nimport * as fs from \"fs-extra\";\r\nimport * as $ from \"../services/mtg\";\r\nimport * as path from \"path\";\r\n\r\n//path.dirname()\r\n\r\nvar moduleName = \"uploadRoutes@\";\r\n\r\nexport function uploadPicture(expReq: e.xRequest<e.IRouteParamId>, expRes: e.Response, next:Function) {\r\n\r\n    var form = new formidable.IncomingForm();\r\n    form.encoding = 'utf-8';\r\n\r\n    form.parse(expReq, function (err:any, fields: formidable.Fields, files: formidable.Files) {\r\n        var sourceFile = files[0].path;\r\n        var destinationFile = path.join($.server.picturesPath, files[0].name);\r\n        $.log.info(destinationFile + \" <= \" + sourceFile );\r\n\r\n        fs.exists(destinationFile,(isFileExisting: boolean) => {\r\n            if (isFileExisting) {\r\n                expRes\r\n                    .status(406)\r\n                    .header({ 'content-type': 'application/json' })\r\n                    .send({ error: true, errorMsg: \"File already exists. Delete first!\" });\r\n            } else {\r\n                fs.rename(sourceFile, destinationFile);\r\n                expRes\r\n                    .status(200)\r\n                    .header({ 'content-type': 'application/json' })\r\n                    .send({ fields: fields, files: files });\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nexport function getAllPictures(expReq: e.xRequest<e.IRouteParamId>, expRes: e.Response, next:Function) {\r\n    fs.readdir($.server.picturesPath,(err: Error, files: string[]) => {\r\n        if (!err) {\r\n            expRes\r\n                .status(200)\r\n                .header({ 'content-type': 'application/json' })\r\n                .send({ files: files });\r\n\r\n        } else {\r\n            expRes\r\n                .status(500)\r\n                .header({ 'content-type': 'application/json' })\r\n                .send({ error: err});\r\n        }\r\n    })\r\n}\r\n\r\nexport function deletePicture(expReq: e.xRequest<e.IRouteParamId>, expRes: e.Response, next:Function) {\r\n    var fileNameToDel: string;\r\n\r\n    if (!expReq.params.id) {\r\n        throw new Error(\"Id parameter is required!\");\r\n    }else{\r\n        fileNameToDel = expReq.params.id;\r\n\r\n        fs.remove(path.join($.server.picturesPath, fileNameToDel),(err: Error) => {\r\n            if (!err) {\r\n                expRes\r\n                    .status(200)\r\n                    .header({ 'content-type': 'application/json' })\r\n                    .send({});\r\n            } else {\r\n                expRes\r\n                    .status(500)\r\n                    .header({ 'content-type': 'application/json' })\r\n                    .send({ error: err });\r\n            }\r\n        }) ;\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}