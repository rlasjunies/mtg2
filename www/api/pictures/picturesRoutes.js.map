{"version":3,"sources":["pictures/picturesRoutes.ts"],"names":["uploadPicture","getAllPictures","deletePicture"],"mappings":"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","file":"pictures/picturesRoutes.js","sourcesContent":["import e = require(\"express\");\r\nimport formidable = require(\"formidable\");\r\nimport fs = require(\"fs-extra\");\r\nimport $ = require(\"../services/mtg\");\r\nimport path = require(\"path\");\r\n\r\n//path.dirname()\r\n\r\nvar moduleName = \"uploadRoutes@\";\r\n\r\nexport function uploadPicture(expReq: e.xRequest<e.IRouteParamId>, expRes: e.Response, next:Function) {\r\n\r\n    var form = new formidable.IncomingForm();\r\n    form.encoding = 'utf-8';\r\n\r\n    form.parse(expReq, function (err:any, fields: formidable.Fields, files: formidable.Files) {\r\n        var sourceFile = files[0].path;\r\n        var destinationFile = path.join($.server.picturesPath, files[0].name);\r\n        $.log.info(destinationFile + \" <= \" + sourceFile );\r\n\r\n        fs.exists(destinationFile,(isFileExisting: boolean) => {\r\n            if (isFileExisting) {\r\n                expRes\r\n                    .status(406)\r\n                    .header({ 'content-type': 'application/json' })\r\n                    .send({ error: true, errorMsg: \"File already exists. Delete first!\" });\r\n            } else {\r\n                fs.rename(sourceFile, destinationFile);\r\n                expRes\r\n                    .status(200)\r\n                    .header({ 'content-type': 'application/json' })\r\n                    .send({ fields: fields, files: files });\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nexport function getAllPictures(expReq: e.xRequest<e.IRouteParamId>, expRes: e.Response, next:Function) {\r\n    fs.readdir($.server.picturesPath,(err: Error, files: string[]) => {\r\n        if (!err) {\r\n            expRes\r\n                .status(200)\r\n                .header({ 'content-type': 'application/json' })\r\n                .send({ files: files });\r\n\r\n        } else {\r\n            expRes\r\n                .status(500)\r\n                .header({ 'content-type': 'application/json' })\r\n                .send({ error: err});\r\n        }\r\n    })\r\n}\r\n\r\nexport function deletePicture(expReq: e.xRequest<e.IRouteParamId>, expRes: e.Response, next:Function) {\r\n    var fileNameToDel: string;\r\n\r\n    if (!expReq.params.id) {\r\n        throw new Error(\"Id parameter is required!\");\r\n    }else{\r\n        fileNameToDel = expReq.params.id;\r\n\r\n        fs.remove(path.join($.server.picturesPath, fileNameToDel),(err: Error) => {\r\n            if (!err) {\r\n                expRes\r\n                    .status(200)\r\n                    .header({ 'content-type': 'application/json' })\r\n                    .send({});\r\n            } else {\r\n                expRes\r\n                    .status(500)\r\n                    .header({ 'content-type': 'application/json' })\r\n                    .send({ error: err });\r\n            }\r\n        }) ;\r\n    }\r\n}\r\n"],"sourceRoot":"/source/"}