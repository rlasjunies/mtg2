<<<<<<< HEAD
{"version":3,"sources":["authentication/googleAuth.ts"],"names":["googleAuth"],"mappings":"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","file":"authentication/googleAuth.js","sourcesContent":["import * as express from \"express\";\r\nimport * as ts from \"./google.typesafe\";\r\n\r\nimport * as libRequest from \"request\";\r\nimport * as libUser from \"../shared/user\";\r\nimport * as libToken from \"./token\";\r\nimport * as $ConfigSecret from \"../services/configSecret\";\r\n\r\ninterface IGoogleProfile {\r\n    sub: string; // GoogleID\r\n    name: string;\r\n    email: string;\r\n    picture: string;\r\n}\r\n\r\n// TODO how to define an interface more precise\r\n// We need to define IGoogleProfile as return of this requestGet\r\n\r\n// export interface request {//extends request.RequestAPI{\r\n//     \t//function post(options: Options, callback?: (error: any, response: any, body: any) => void): Request;\r\n// \t\tfunction get(options: request.Options, callback?: (error: any, response: any, body: IGoogleProfile) => void): Request;\r\n// }\r\n\r\nexport function googleAuth(expReq: express.Request, expRes: express.Response) {\r\n    var tsBody = <ts.IAuthGoogleBody>expReq.body;\r\n    //console.log(tsBody.code);\r\n\r\n    var opt: libRequest.Options = {\r\n        url: \"https://accounts.google.com/o/oauth2/token\",\r\n        json: true,\r\n        form: {\r\n            code: tsBody.code,\r\n            client_id: tsBody.clientId,\r\n            redirect_uri: tsBody.redirectUri,\r\n            grant_type: \"authorization_code\",\r\n            client_secret: $ConfigSecret.GOOGLE_SECRET\r\n        }\r\n    };\r\n\r\n    libRequest.post(opt, (err, response, token) => {\r\n        //console.log(\"\\ngoogleAuth - token: \" + JSON.stringify(token));\r\n        if (err) {\r\n            throw err;\r\n        }\r\n\r\n\r\n        var accessToken = token.access_token;\r\n        var headers: libRequest.Headers = {};\r\n        headers[\"Authorization\"] = \"Bearer \" + accessToken;\r\n\r\n        var requestParams: libRequest.Options = {};\r\n        requestParams.url = \"https://www.googleapis.com/plus/v1/people/me/openIdConnect\";\r\n        requestParams.headers = headers;\r\n        requestParams.json = true;\r\n        libRequest.get(requestParams, (err:any, response:any, profile: IGoogleProfile) => {\r\n            //console.log(\"\\ngoogleAuth:\" + err + response + JSON.stringify(profile));\r\n            if (err) {\r\n                throw err;\r\n            }\r\n\r\n            var userModel = libUser.userModel();\r\n\r\n            userModel.findOne({\r\n                email: profile.email\r\n            }, (err, foundUser) => {\r\n                    if (foundUser) {\r\n                        return libToken.createSendToken(foundUser, expRes);\r\n                    }\r\n\r\n                    var userModel = libUser.userModel();\r\n\r\n                    var userDoc: libUser.IUserDocument = new userModel({});\r\n\r\n                    userDoc.email = profile.email;\r\n                    userDoc.displayName = profile.name;\r\n                    userDoc.googleId = profile.sub;\r\n                    userDoc.picture = profile.picture;\r\n\r\n                    userDoc.save((err) => {\r\n                        // if (err) return next(err);\r\n                        if (err) {\r\n                            throw err;\r\n                        }\r\n                        libToken.createSendToken(userDoc, expRes);\r\n                    });\r\n                });\r\n        });\r\n    });\r\n\r\n    // res.status(200).send({ message: \"fine!\" });\r\n}\r\n"],"sourceRoot":"/source/"}
=======
{"version":3,"sources":["authentication/googleAuth.ts"],"names":["googleAuth"],"mappings":"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","file":"authentication/googleAuth.js","sourcesContent":["import express = require(\"express\");\r\n// import mongoose = require(\"mongoose\");\r\n\r\nimport ts = require(\"./google.typesafe\");\r\n\r\nimport libRequest = require(\"request\");\r\nimport libUser = require(\"../shared/user\");\r\nimport libToken = require(\"./token\");\r\nimport $ConfigSecret = require(\"../services/configSecret\");\r\n\r\ninterface IGoogleProfile {\r\n    sub: string; // GoogleID\r\n    name: string;\r\n    email: string;\r\n    picture: string;\r\n}\r\n\r\n// TODO how to define an interface more precise\r\n// We need to define IGoogleProfile as return of this requestGet\r\n\r\n// export interface request {//extends request.RequestAPI{\r\n//     \t//function post(options: Options, callback?: (error: any, response: any, body: any) => void): Request;\r\n// \t\tfunction get(options: request.Options, callback?: (error: any, response: any, body: IGoogleProfile) => void): Request;\r\n// }\r\n\r\nexport function googleAuth(expReq: express.Request, expRes: express.Response) {\r\n    var tsBody = <ts.IAuthGoogleBody>expReq.body;\r\n    //console.log(tsBody.code);\r\n\r\n    var opt: libRequest.Options = {\r\n        url: \"https://accounts.google.com/o/oauth2/token\",\r\n        json: true,\r\n        form: {\r\n            code: tsBody.code,\r\n            client_id: tsBody.clientId,\r\n            redirect_uri: tsBody.redirectUri,\r\n            grant_type: \"authorization_code\",\r\n            client_secret: $ConfigSecret.GOOGLE_SECRET\r\n        }\r\n    };\r\n\r\n    libRequest.post(opt, (err, response, token) => {\r\n        //console.log(\"\\ngoogleAuth - token: \" + JSON.stringify(token));\r\n        if (err) {\r\n            throw err;\r\n        }\r\n\r\n\r\n        var accessToken = token.access_token;\r\n        var headers: libRequest.Headers = {};\r\n        headers[\"Authorization\"] = \"Bearer \" + accessToken;\r\n\r\n        var requestParams: libRequest.Options = {};\r\n        requestParams.url = \"https://www.googleapis.com/plus/v1/people/me/openIdConnect\";\r\n        requestParams.headers = headers;\r\n        requestParams.json = true;\r\n        libRequest.get(requestParams, (err:any, response:any, profile: IGoogleProfile) => {\r\n            //console.log(\"\\ngoogleAuth:\" + err + response + JSON.stringify(profile));\r\n            if (err) {\r\n                throw err;\r\n            }\r\n\r\n            var userModel = libUser.userModel();\r\n\r\n            userModel.findOne({\r\n                email: profile.email\r\n            }, (err, foundUser) => {\r\n                    if (foundUser) {\r\n                        return libToken.createSendToken(foundUser, expRes);\r\n                    }\r\n\r\n                    var userModel = libUser.userModel();\r\n\r\n                    var userDoc: libUser.IUserDocument = new userModel({});\r\n\r\n                    userDoc.email = profile.email;\r\n                    userDoc.displayName = profile.name;\r\n                    userDoc.googleId = profile.sub;\r\n                    userDoc.picture = profile.picture;\r\n\r\n                    userDoc.save((err) => {\r\n                        // if (err) return next(err);\r\n                        if (err) {\r\n                            throw err;\r\n                        }\r\n                        libToken.createSendToken(userDoc, expRes);\r\n                    });\r\n                });\r\n        });\r\n    });\r\n\r\n    // res.status(200).send({ message: \"fine!\" });\r\n}\r\n"],"sourceRoot":"/source/"}
>>>>>>> origin/master
